@model Ivap.Areas.Configuration.Models.EntityComponentModel
@using System.Data;
@using Ivap.Repository;
@{
    ViewBag.Title = "Component List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    DataSet ds = new DataSet();
    ds = ViewBag.Publishds;
}

<style>
    .demo-section label {
        margin-bottom: 5px;
        font-weight: bold;
        display: inline-block;
    }

    .hidebutton {
        display: none;
    }

    #employees {
    }

    #example .demo-section {
        max-width: none;
    }

    #example .k-listbox {
        width: 100%;
        height: 310px;
    }

        #example .k-listbox:first-of-type {
            margin-right: 1px;
        }

    .k-ghost {
        display: none !important;
    }

    .custom-placeholder {
        opacity: 0.4;
    }

    #example .k-item {
        line-height: 3em;
    }
    /* Material Theme padding adjustment*/

    .k-material #example .k-item,
    .k-material #example .k-item.k-state-hover,
    .k-materialblack #example .k-item,
    .k-materialblack #examplel .k-item.k-state-hover {
        padding-left: 5px;
        border-left: 0;
    }

    .k-item > span {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
        display: inline-block;
        vertical-align: top;
        margin: 20px 10px 10px 5px;
    }

    #example .k-item > span:first-child,
    .k-item.k-drag-clue > span:first-child {
        -moz-box-shadow: inset 0 0 30px rgba(0,0,0,.3);
        -webkit-box-shadow: inset 0 0 30px rgba(0,0,0,.3);
        box-shadow: inset 0 0 30px rgba(0,0,0,.3);
        margin: 8px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-size: 100%;
        background-repeat: no-repeat;
        TEXT-ALIGN: CENTER;
    }

    #example h3,
    .k-item.k-drag-clue h3 {
        font-size: 1.2em;
        font-weight: normal;
        margin: 0 0 1px 0;
        padding: 0;
    }

    /*.k-item {
        line-height: 3em;
        text-align: center;
        margin-left: -211px;
    }*/

    #example p {
        margin: 0;
        padding: 0;
        font-size: .8em;
    }

    h4 {
        color: #3a3a3a;
        margin: 0px;
        padding: 0px;
        font-size: 12px !important;
        font-family: arial, sans-serif, Arial !important;
        text-align: left;
    }
</style>

<div id="tab" class="modal fade PopUpMainDiv" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <img src="~/Content/images/popup_close.png" alt="Close " />
                </button>
                <h4 style="font-size: 16px !important" class="modal-title">Entity Component</h4>
            </div>
            <div class="modal-body">
                <div class="nav-tabs-custom">
                    <ul class="nav nav-tabs">
                        <li class="active"><a href="#tab_1" data-toggle="tab" aria-expanded="true">Detail</a></li>
                        <li class=""><a href="#tab_2" data-toggle="tab" aria-expanded="false">History</a></li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="tab_1">
                            <table id="example2" class="table table-bordered table-hover">
                                <tbody>
                                    <tr>


                                        <td> <label>COMPONENT FILE TYPE</label> </td>
                                        <td><span id="lblComponentFileType"> </span></td>
                                        <td> <label>Component Type</label> </td>
                                        <td><span id="lblComponentType"></span></td>
                                    </tr>
                                    <tr>
                                        <td> <label>COMPONENT_SUB_TYPE</label> </td>
                                        <td><span id="lblComponentSubType"> </span></td>
                                        <td> <label>COMPONENT_DATATYPE</label> </td>
                                        <td><span id="lblComponentDataType"> </span></td>
                                    </tr>
                                    <tr>
                                        <td> <label>COMPONENT_TABLE_NAME</label> </td>
                                        <td><span id="lblComponentTablename"> </span></td>
                                        <td> <label>COMPONENT_COLUMN_NAME</label> </td>
                                        <td><span id="lblComponentColumnName"> </span></td>
                                    </tr>
                                    <tr>
                                        <td> <label>COMPONENT_NAME</label> </td>
                                        <td><span id="lblComponentName"> </span></td>
                                        <td> <label>COMPONENT DISPLAY NAME</label> </td>
                                        <td><span id="lblCompDispName"> </span></td>
                                    </tr>
                                    <tr>
                                        <td> <label>COMPONENT DESCRIPTION</label> </td>
                                        <td><span id="lblCompDesc"> </span></td>
                                        <td> <label>MIN LENGTH</label> </td>
                                        <td><span id="lblMinLength"> </span></td>
                                    </tr>
                                    <tr>
                                        <td> <label>MAX LENGTH</label> </td>
                                        <td><span id="lblMaxLength"> </span></td>
                                        <td> <label>MANDATORY</label> </td>
                                        <td><span id="lblMandatory"> </span></td>
                                    </tr>

                                    <tr>
                                        <td> <label>ISACTIVE</label> </td>
                                        <td><span id="lblIsActive"> </span></td>
                                    </tr>
                                    @*<tr>
                                            <td> <label>Status</label> </td>
                                            <td><span id="lblStatus"></span></td>
                                        </tr>*@
                                </tbody>
                            </table>

                        </div>
                        <!-- /.tab-pane -->
                        <div class="tab-pane" id="tab_2">
                            <div id="kgrdHistory"></div>
                        </div>
                        <!-- /.tab-pane -->
                        <!-- /.tab-pane -->
                    </div>
                    <!-- /.tab-content -->
                </div>
            </div>
        </div>
    </div>
</div>

<div class="panel panel-default">
    @*<div class="pull-right VendorSiteBtnRightMain">
            <button type="button" id="btnHRComponent" data-field="HRDMAST" class="btn btn-primary TransparantBtnBlue">Add HR Component</button>
            <button type="button" id="btnSalComponent" data-field="PAYMAST" class="btn btn-primary TransparantBtnBlue">Add Salary Component</button>
            @*<button type="button"  class="btn btn-primary BtnBlueLg BtnWidth150">Export</button>
        </div>
        <div class="panel-heading">
            <h2>Entity Component</h2>
            <div class="clear5"></div>
        </div>*@

    <div class="panel-body">
        @*<div class="">  <h4>Check Your Annexure Status</h4>  </div>*@
        <div class="clear10"></div>
        <div class="nav-tabs-custom">
            <ul class="nav nav-tabs NotificationsTabMain">
                <li class="active"><a style="background-color:#fff!important;margin-right:28px;" data-field="HRDMAST" data-toggle="tab" id="HRTab" href="#HRComponentTab">HR Component</a></li>
                <li><a style="background-color:#fff!important;margin-right:28px;" class="invoice" data-field="PAYMAST" data-toggle="tab" id="SalaryTab" href="#SalaryComponentTab">Salary Component</a></li>
            </ul>
            <div class="clear10"></div>
            <div class="tab-content">
                <div id="HRComponentTab" class="tab-pane fade in active">
                    <div class="pull-right VendorSiteBtnRightMain">
                        @if (AuthorizationRepo.IsValidAction("EntityComponentsList", "CreateAction"))
                        {
                            if (ds.Tables[0].Rows.Count < 1)
                            {
                                <button type="button" id="btnHRP" class="btn btn-primary TransparantBtnBlue">Publish HR</button>
                            }

                            <button type="button" id="btnHRComponent" data-field="HRDMAST" class="btn btn-primary BtnBlueLg BtnWidth150">Add HR</button>
                        }
                    </div>
                    <div class="NotificationsBoxMain">
                        <div class="TableOuterDiv table-responsive">
                            <div id="HRComponentKgrd" style="height:330PX"></div>
                        </div>
                    </div>
                </div>
                <div id="SalaryComponentTab" class="tab-pane">
                    <div class="pull-right VendorSiteBtnRightMain">
                        @if (AuthorizationRepo.IsValidAction("EntityComponentsList", "CreateAction"))
                        {
                            if (ds.Tables[1].Rows.Count < 1)
                            {
                                <button type="button" id="btnSALP" class="btn btn-primary TransparantBtnBlue">Publish Salary</button>
                            }

                            <button type="button" id="btnSalComponent" data-field="PAYMAST" class="btn btn-primary BtnBlueLg BtnWidth150">Add Salary</button>
                        }
                    </div>
                    <div class="NotificationsBoxMain">
                        <div class="TableOuterDiv table-responsive">
                            <div id="SalaryComponentKgrd" style="height:330PX"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div id="dvEntityComponent" class="modal fade PopUpMainDiv" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <img src="~/Content/images/popup_close.png" alt="Close " />
                </button>
                <h4 style="font-size: 16px !important" class="modal-title">Edit Component</h4>
            </div>
            @using (Ajax.BeginForm("UpdateEntityComponent", new AjaxOptions { OnSuccess = "SuccessMessage" }))
            {
                @Html.AntiForgeryToken()
                <div class="modal-body">
                    <div class="row form-group">
                        <label for="inputPassword3" class="col-sm-2 control-label">Display Name<span class="text-red">*</span></label>
                        <div class="col-sm-4">
                            @Html.HiddenFor(m => m.EntityCOMPID, new { id = "hdnEntityCompID" })
                            @Html.HiddenFor(m => m.Globle_Component_ID, new { id = "hdnGlobalCompID" })
                            @Html.HiddenFor(m => m.File_Type, new { id = "hdnFileType" })
                            @Html.TextBoxFor(m => m.COMPONENT_DISPLAY_NAME, new { @class = "form-control", @placeholder = "Display Name" })
                            @Html.ValidationMessageFor(m => m.COMPONENT_DISPLAY_NAME)
                        </div>
                        <label for="inputPassword3" class="col-sm-2 control-label">PMS Code</label>
                        <div class="col-sm-4">
                            @Html.TextBoxFor(m => m.PMS_Code, new { @class = "form-control", @placeholder = "PMS CODE" })
                            @Html.ValidationMessageFor(m => m.PMS_Code)
                        </div>
                        
                    </div>
                    <div class="row form-group">
                        <label for="inputPassword3" class="col-sm-2 control-label">GL Code</label>
                        <div class="col-sm-4">
                            @Html.TextBoxFor(m => m.GL_Code, new { @class = "form-control", @placeholder = "GL Code" })
                            @Html.ValidationMessageFor(m => m.GL_Code)
                        </div>
                        <div class="col-sm-4">
                        </div>

                    </div>
                    <div class="row form-group">
                        <label for="inputPassword3" class="col-sm-2 control-label">Mandatory</label>
                        <div class="col-sm-4">
                            @Html.CheckBoxFor(m => m.MANDATORY)
                        </div>
                        <label for="inputPassword3" class="col-sm-2 control-label">Is Active</label>
                        <div class="col-sm-4">
                            @Html.CheckBoxFor(m => m.IsActive)
                        </div>
                    </div>
                </div>
                <input type="reset" id="btnReset" value="Reset" class="btn btn-primary BtnWhiteLg BtnWidth150" />
                <input type="submit" id="btnSubmit" class="btn btn-primary BtnBlueLg BtnWidth150" value="Submit" />
                <div class="panel-body">
                    <div class="TableOuterDiv table-responsive">
                        <div id="KModelgrd"></div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<div id="dvDeleteEntityCom" class="modal fade PopUpMainDiv" role="dialog">
    <div class="modal-dialog" style="width:500px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <img src="~/Content/images/popup_close.png" alt="Close " />
                </button>
                <h4 style="font-size: 16px !important" class="modal-title">Delete Confirmation</h4>
            </div>
            <div class="modal-body">
                <div class="clear10"></div>
                <div class="row">
                    <div class="col-md-1 col-sm-1 col-lg-1 col-xs-12"></div>
                    <div class="col-md-10 col-sm-10 col-lg-10 col-xs-12">
                        <div id="dvConfirmationTxt">
                            <label id="SpnComponentName"></label>
                        </div>
                        <div class="clear20"></div>
                        <input type="submit" id="btnReject" class="btn btn-primary BtnWhiteLg BtnWidth99" value="Cancel" />
                        <input type="submit" id="btnAccept" class="btn btn-primary BtnBlueLg BtnWidth99" value="Delete" />
                        <div class="clear20"></div>
                    </div>
                    <div class="col-md-1 col-sm-1 col-lg-1 col-xs-12"></div>
                </div>
                <!-- /.box-body -->
            </div>
        </div>
    </div>
</div>
<div id="dvComponent" class="modal fade PopUpMainDiv" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <img src="~/Content/images/popup_close.png" alt="Close " />
                </button>
                <h4 style="font-size: 16px !important" class="modal-title">Add Component</h4>
            </div>
            <div class="modal-body">
                <div id="example" role="application">
                    <div class="demo-section k-content">
                        <div>
                            <div class="row">
                                <div class="col-sm-6">
                                    @*<label for="optional" id="employees">Globle Component</label>*@
                                    <input type="text" class="form-control" id="txtSearchComponent" style="margin-bottom: 5px;font-weight: bold;display: inline-block;" placeholder="Search Globle Component" />
                                    @*<input type="text" />*@
                                </div>
                                <div class="col-sm-6">
                                    <label for="selected">Entity Component</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <select id="ddlGlobleComponent"></select>
                                </div>
                                <div class="col-sm-6">
                                    <select id="selectedComponent"></select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clear10"></div>
            <input type="button" id="btnEntityReset" value="Reset" class="btn btn-primary BtnWhiteLg BtnWidth150" />
            <input type="submit" id="btnEntitySubmit" class="btn btn-primary BtnBlueLg BtnWidth150" value="Submit" />
            <div class="clear20"></div>
        </div>
    </div>
</div>

@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "__AjaxAntiForgeryForm" }))
{
    @Html.AntiForgeryToken()
}

@section scripts {
    @Scripts.Render("~/Scripts/commanscript")
    <script>
        var EntityTemplate = '<span>#:data.COMPONENT_NAME.charAt(0)#</span>' +
            '<span class="k-state-default"><h4>#: data.COMPONENT_NAME # - #: data.COMPONENT_DISPLAY_NAME #</h4><p>#: data.COMPONENT_TYPE # #: data.COMPONENT_SUB_TYPE #</p></span>';
        var ComponentListBox = "";
        var Condition = 1;

        $("#txtSearchComponent").keypress(function (e) {
            //e.preventDefault();
            var SearchText = $(this).val().trim();
            if (SearchText.length > 2) {
                //if (!flag) {
                //    BindGlobleComponent();
                //    flag = true;
                //}
                if (SearchText.length==3) {
                    BindGlobleComponent();
                }
               // $("#txtSearchComponent").attr("disabled", true);
            }
        });

        $("#txtSearchComponent").keyup(function (e) {
            var SearchText = $(this).val().trim();
            if (e.keyCode == 46 || e.keyCode == 8) {
                if (SearchText.length == 0) {
                    BindGlobleComponent();
                }
            }
        });

        function BindGlobleComponent() {
            var ddlEntitycomID = "";
            var SplitedEntityComID = "";
            if (Condition == 1) {
                Condition = 2;
            }
            else {
                ddlEntitycomID = GetArrayEntityComponent();
                SplitedEntityComID = ddlEntitycomID.join(",", ddlEntitycomID);
            }
            var Search_Text = $("#txtSearchComponent").val().trim();
            var GetMasterMetaURL = '@Url.RouteUrl("GetGlobleComponentsList")';

            $.ajax({
                url: GetMasterMetaURL,
                type: "GET",
                dataType: "json",
                data: { COMPONENT_FILE_TYPE: FileType, Search_Text: Search_Text, EntityCompID: SplitedEntityComID  },
                success: function (response) {
                    flag = false;
                  //  $("#txtSearchComponent").attr("disabled", false);
                    if (ComponentListBox == "") {
                        //$('#ddlGlobleComponent').kendoListBox('destroy').empty();
                        ComponentListBox = $("#ddlGlobleComponent").kendoListBox({
                            dataTextField: "COMPONENT_NAME",
                            dataValueField: "TID",
                            template: EntityTemplate,
                            //dataSource: {
                            //    data: JSON.parse(response.Data)
                            //},
                            draggable: { placeholder: customPlaceholder },
                            dropSources: ["selectedComponent"],
                            connectWith: "selectedComponent",
                            toolbar: {
                                position: "right",
                                tools: ["transferTo", "transferFrom", "transferAllTo", "transferAllFrom", "remove"]
                            }
                        });
                        $("#ddlGlobleComponent").data("kendoListBox").dataSource.data(JSON.parse(response.Data));
                    }
                    else {
                        $("#ddlGlobleComponent").data("kendoListBox").setDataSource(new kendo.data.DataSource({
                            data: JSON.parse(response.Data)
                        }));

                    }

                }
            })


            //$.get(GetMasterMetaURL, { COMPONENT_FILE_TYPE: FileType, Search_Text: Search_Text, EntityCompID: SplitedEntityComID }, function (response) {
            //    flag = false;
            //    if (ComponentListBox == "") {
            //        //$('#ddlGlobleComponent').kendoListBox('destroy').empty();
            //        ComponentListBox = $("#ddlGlobleComponent").kendoListBox({
            //            dataTextField: "COMPONENT_NAME",
            //            dataValueField: "TID",
            //            template: EntityTemplate,
            //            //dataSource: {
            //            //    data: JSON.parse(response.Data)
            //            //},
            //            draggable: { placeholder: customPlaceholder },
            //            dropSources: ["selectedComponent"],
            //            connectWith: "selectedComponent",
            //            toolbar: {
            //                position: "right",
            //                tools: ["transferTo", "transferFrom", "transferAllTo", "transferAllFrom", "remove"]
            //            }
            //        });
            //        $("#ddlGlobleComponent").data("kendoListBox").dataSource.data(JSON.parse(response.Data));
            //    }
            //    else
            //    {
            //        $("#ddlGlobleComponent").data("kendoListBox").setDataSource(new kendo.data.DataSource({
            //            data: JSON.parse(response.Data)
            //        }));
            //    }




            //});
        }


        function customPlaceholder(draggedItem) {
            return draggedItem
                .clone()
                .addClass("custom-placeholder")
                .removeClass("k-ghost");
        }
        var selectedComponentList = "";
        $(document).ready(function () {
            BindGlobleComponent();
            selectedComponentList=   $("#selectedComponent").kendoListBox({
                dataTextField: "COMPONENT_NAME",
                dataValueField: "TID",
                template: EntityTemplate,
                //draggable: { placeholder: customPlaceholder },
                //dropSources: ["ddlGlobleComponent"],
                connectWith: "ddlGlobleComponent"
            });

        });
        var FileType = "HRDMAST";
        $("#btnHRComponent,#btnSalComponent").click(function () {
            FileType = $(this).attr("data-field");
            $("#txtSearchComponent").val('');
            BindGlobleComponent();
            OpenModal("dvComponent", 909, "Entity Details");
            ResetEntitySelect();

        })

        function ClearList() {
            $("#txtSearchComponent").val('');
            //  FileType = "";
            // BindGlobleComponent();
            var SelectComp = $("#selectedComponent").data("kendoListBox");
            SelectComp.dataSource.read();
            SelectComp.refresh();
            var SelectGlobalComp = $("#ddlGlobleComponent").data("kendoListBox");
            SelectGlobalComp.dataSource.read();
            SelectGlobalComp.refresh();
        }

          //////////////////
        $("#btnEntitySubmit").click(AddEntityComponent);

         function GetArrayEntityComponent() {
             var listBox = $("#selectedComponent").data("kendoListBox");
             var Data = listBox.dataSource.data();
             var EntityComponentID = [];
             for (var i = 0; i < Data.length; i++) {
                 var TID = Data[i].TID;
                 EntityComponentID.push(TID);
             }
             return EntityComponentID;
         }
         function AddEntityComponent() {
             var EntitycomID = GetArrayEntityComponent();
             if (EntitycomID.length <= 0) {
                 var response = { "Message": "Select component First" };
                 HandleSuccessMessage(response);
             }
         else {
                 var form = $('#__AjaxAntiForgeryForm');
                 var token = $('input[name="__RequestVerificationToken"]', form).val();
                 $.post("@Url.RouteUrl("AddEntityComponent")", { __RequestVerificationToken: token, EntityCompID: EntitycomID, COMPONENT_FILE_TYPE: FileType  }, function (response) {
                     if (response.IsSuccess) {
                         HandleSuccessMessage(response);
                         if (FileType == "HRDMAST") {
                             BindHRComponentGrid();
                         }

                         if (FileType == "PAYMAST") {
                             BindSalaryComponentGrid();
                         }
                         $('#dvComponent').modal('toggle');
                         ResetEntitySelect();
                     }
                 });
             }
        }

        ////////////////////
    </script>
    <script>

        $(document).ready(function () {
            $("#li1").addClass("active");
            $("#anch33").addClass("CurantPageIcon");
            BindHRComponentGrid();
            BindSalaryComponentGrid();
            $("#btnEntityReset").click(ResetEntitySelect);
         });
        var ComponentFileType = "HRDMAST";
        $("#HRTab,#SalaryTab").click(function () {
            ComponentFileType = $(this).attr("data-field");
        })
        //HRComponent Area////////////////////////////////////////
        var HRComponentgrid = "";
        function BindHRComponentGrid() {
            var EntityComponentID = 0;
            $.get("@Url.RouteUrl("getEntityComponent")", { EntityCompID: EntityComponentID, COMPONENT_FILE_TYPE:"HRDMAST" }, function (response) {
                if (HRComponentgrid != "") {
                    $('#HRComponentKgrd').kendoGrid('destroy').empty();
                }
                var GridColumns = [

                    { field: "COMPONENT_TYPE", title: "Component Type", width: 130 },
                    { field: "COMPONENT_SUB_TYPE", title: "Component Sub Type", width: 150 },
                    { field: "COMPONENT_NAME", title: "Component Name", width: 150 },
                    { field: "COMPONENT_DISPLAY_NAME", title: "Display Name", width: 150 },
                    {
                        command:
                        [
                            { name: "Edit", text: "", iconClass: "kIcon  kIconEdit ", click: EditHandler, title: "Edit" },
                            { name: "Delete", text: "", iconClass: "kIcon kdelete ", click: DeleteHandler, title: "Delete" },
                            { name: "View", text: "", iconClass: "kIcon kIconView ", click: ViewHandler, title: "View" },
                        ], title: "Action", width: 140
                    },

                ];
                //if (response.Command != null) {
                //    for (var i = 0; i < response.Command.command.length; i++) {
                //        if (response.Command.command[i].name == "Edit")
                //            response.Command.command[i].click = EditHandler;
                //        else if (response.Command.command[i].name == "Edit")
                //            response.Command.command[i].click = DeleteHandler;
                //    }
                //    GridColumns.push(response.Command);
                //}
                HRComponentgrid = $("#HRComponentKgrd").kendoGrid({
                    dataSource: {
                        pageSize: 15,
                        data: JSON.parse(response.Data)
                    },
                    pageable: { pageSizes: true },
                    height: 330,
                    filterable: true,
                    noRecords: true,
                    resizable: true,
                    //reorderable: true,
                    dataBound: ShowToolTip,
                    sortable: true,
                    columns: GridColumns,
                });

            });
        }
       //End HRComponent Area////////////////////////////////////////

       //SalaryComponent Area////////////////////////////////////////
        var SalaryComponentgrid = "";
        function BindSalaryComponentGrid() {
            var EntityComponentID = 0;
            $.get("@Url.RouteUrl("getEntityComponent")", { EntityCompID: EntityComponentID ,COMPONENT_FILE_TYPE:"PAYMAST" }, function (response) {
                if (SalaryComponentgrid != "") {
                    $('#SalaryComponentKgrd').kendoGrid('destroy').empty();
                }
                var GridColumns = [

                    { field: "COMPONENT_TYPE", title: "Component Type", width: 130 },
                    { field: "COMPONENT_SUB_TYPE", title: "Component Sub Type", width: 150 },
                    { field: "COMPONENT_NAME", title: "Component Name", width: 150 },
                    { field: "COMPONENT_DISPLAY_NAME", title: "Display Name", width: 150 },
                    {
                        command:
                        [
                            { name: "Edit", text: "", iconClass: "kIcon  kIconEdit ", click: EditHandler, title: "Edit" },
                            { name: "Delete", text: "", iconClass: "kIcon kdelete ", click: DeleteHandler, title: "Delete" },
                            { name: "View", text: "", iconClass: "kIcon kIconView ", click: ViewHandler, title: "View" },
                        ], title: "Action", width: 140
                    },

                ];
                SalaryComponentgrid = $("#SalaryComponentKgrd").kendoGrid({
                    dataSource: {
                        pageSize: 15,
                        data: JSON.parse(response.Data)
                    },
                    pageable: { pageSizes: true },
                    height: 330,
                    filterable: true,
                    noRecords: true,
                    resizable: true,
                    //reorderable: true,
                    dataBound: ShowToolTip,
                    sortable: true,
                    columns: GridColumns,
                });

            });
        }
       //End HRComponent Area////////////////////////////////////////


        function SuccessMessage(res) {
            if ($("#hdnEntityCompID").val() > 0)
                $("#dvEntityComponent").modal('hide');
            HandleSuccessMessage(res, "btnReset");
            if (ComponentFileType == "HRDMAST") {
                BindHRComponentGrid();
            }

            if (ComponentFileType == "PAYMAST") {
                BindSalaryComponentGrid();
            }
        }
        var DeEntityCompID = '';
        var DeFILE_TYPE = '';
        var DeleteCOMPONENT_NAME = '';
                var DeleteHandler = function DeleteHandler(e) {
                    e.preventDefault();
                    dataItem = this.dataItem($(e.currentTarget).closest("tr"));
                    DeEntityCompID = dataItem.TID;
                    DeFILE_TYPE = dataItem.COMPONENT_FILE_TYPE;
                    DeleteCOMPONENT_NAME = dataItem.COMPONENT_NAME;
                    if (dataItem.COMPONENT_FILE_TYPE == "HRDMAST") {
                        $("#SpnComponentName").html('Are you sure you want to delete HR Component ' + dataItem.COMPONENT_NAME + " ?");
                    }
                    if (dataItem.COMPONENT_FILE_TYPE == "PAYMAST") {
                        $("#SpnComponentName").html('Are you sure you want to delete Salary Component ' + dataItem.COMPONENT_NAME + " ?");
                    }
                    // OpenModal("dvDeleteEntityCom");
                    OpenModal("dvDeleteEntityCom", 150, "Delete Confirmation");
                }

                $("#btnAccept").click(function () {
                    var form = $('#__AjaxAntiForgeryForm');
                    var token = $('input[name="__RequestVerificationToken"]', form).val();
                    $.post("@Url.RouteUrl("DeleteEntityComponent")", { __RequestVerificationToken: token, EntityCompID: DeEntityCompID, COMPONENT_FILE_TYPE: DeFILE_TYPE }, function (response) {
                        if (!response.IsSuccess) {
                            response.Message = "First Delete Component " + DeleteCOMPONENT_NAME + " from File Component Details."
                            HandleSuccessMessage(response);
                            $('#dvDeleteGlobalCom').modal('toggle');
                        }
                        if (response.IsSuccess) {
                            HandleSuccessMessage(response);
                            $('#dvDeleteEntityCom').modal('toggle');
                            if (ComponentFileType == "HRDMAST") {
                                BindHRComponentGrid();
                            }
                            if (ComponentFileType == "PAYMAST") {
                                BindSalaryComponentGrid();
                            }
                        }
                    });
                });




                $("#btnReject").click(function () {
                    $('#dvDeleteEntityCom').modal('toggle');
                });

        var EditHandler = function EditHandler(e) {
            $("#btnReset").click();
            e.preventDefault();
            dataItem = this.dataItem($(e.currentTarget).closest("tr"));
            var EntityComponentID = dataItem.TID;
            $.get('@Url.RouteUrl("getEntityComponent")', { EntityCompID: EntityComponentID, COMPONENT_FILE_TYPE: ComponentFileType }, function (response) {

                var Data = $.parseJSON(response.Data);
                $("#hdnGlobalCompID").val(htmlEncode(Data[0].GLOBLE_COMPONENT_ID));
                $("#hdnEntityCompID").val(EntityComponentID);
                $("#hdnFileType").val(htmlEncode(Data[0].COMPONENT_FILE_TYPE))
                $("#COMPONENT_DISPLAY_NAME").val(htmlEncode(Data[0].COMPONENT_DISPLAY_NAME));
                $("#PMS_Code").val(htmlEncode(Data[0].PMS_CODE));
                $("#GL_Code").val(htmlEncode(Data[0].GL_CODE));
                var IsAct = Data[0].ISACTIVE;
                (IsAct == 1) ? $('#IsActive').prop('checked', true) : $('#IsActive').prop('checked', false);
                var IsMandatory = Data[0].MANDATORY;
                (IsMandatory == 1) ? $('#MANDATORY').prop('checked', true) : $('#MANDATORY').prop('checked', false);
                $("#btnSubmit").val("Update");
                BindModelGrid();
                OpenModal("dvEntityComponent", 700, "Edit EntityComponent");

            });
        }

        var ViewHandler = function ViewHandler(e) {
            e.preventDefault();
            dataItem = this.dataItem($(e.currentTarget).closest("tr"));
            var EntityComponentID = dataItem.TID;
            $.get("@Url.RouteUrl("getEntityComponent")", { EntityCompID: EntityComponentID, COMPONENT_FILE_TYPE: "" }, function (response) {

                var Data = $.parseJSON(response.Data);
                $("#lblComponentTablename").html(htmlEncode(Data[0].COMPONENT_TABLE_NAME));
                $("#lblComponentColumnName").html(htmlEncode(Data[0].COMPONENT_COLUMN_NAME));
                $("#lblComponentFileType").html(htmlEncode(Data[0].COMPONENT_FILE_TYPE));
                // $("#lblComponentType").html(htmlEncode(Data[0].COMPONENT_TYPE));
                $("#lblComponentSubType").html(htmlEncode(Data[0].COMPONENT_SUB_TYPE));
                $("#lblComponentName").html(htmlEncode(Data[0].COMPONENT_TYPE));
                $("#lblComponentDataType").html(Data[0].COMPONENT_DATATYPE);
                $("#lblCompDispName").html(htmlEncode(Data[0].COMPONENT_DISPLAY_NAME));
                $("#lblCompDesc").html(htmlEncode(Data[0].COMPONENT_DESCRIPTION));
                $("#lblMinLength").html(Data[0].MIN_LENGTH);
                $("#lblMaxLength").html(htmlEncode(Data[0].MAX_LENGTH));
                $("#lblMandatory").html(htmlEncode(Data[0].MANDATORY_STATUS));
                $("#lblIsActive").html(Data[0].STATUS);
                HistoryGridData(EntityComponentID);
            });
        }

        function ResetEntitySelect() {
            if (ComponentListBox != "") {
                $('#ddlGlobleComponent').data("kendoListBox").dataSource.data([]);
            }
            $('#selectedComponent').data("kendoListBox").dataSource.data([]);
        }
        //$("#COMPONENT_DATATYPE").change(function () {
        //    $("#dvMinMax").hide();
        //    if (this.value != "MASTER") {
        //        $("#dvMinMax").show();
        //    }
        //})

        ///////Publish///////
        $("#btnHRP").click(function () {
            var form = $('#__AjaxAntiForgeryForm');
            var token = $('input[name="__RequestVerificationToken"]', form).val();
            $.post("@Url.RouteUrl("PublishHRDMaster")", { __RequestVerificationToken: token }, function (response) {
                if (response.IsSuccess) {
                    $("#btnHRP").remove();
                    // $("#btnHRP").addClass("hidebutton");
                    HandleSuccessMessage(response);
                }
                if (!response.IsSuccess) {
                    HandleSuccessMessage(response);
                }
            });
        });
        $("#btnSALP").click(function () {
            var form = $('#__AjaxAntiForgeryForm');
            var token = $('input[name="__RequestVerificationToken"]', form).val();
            $.post("@Url.RouteUrl("PublishPayMaster")", { __RequestVerificationToken: token }, function (response) {
                if (response.IsSuccess) {
                    // $("#btnHRP").prop('disabled', true);
                    $("#btnSALP").remove();
                    //  $("#btnSALP").addClass("hidebutton");
                    HandleSuccessMessage(response);
                }
                if (!response.IsSuccess) {
                    HandleSuccessMessage(response);
                }
            });
        });
        /////////////////////////////////

    </script>
    <script>

        function HistoryGridData(EntityComponentID) {
            $.ajax({
                type: "GET",
                url: "@Url.RouteUrl("GetEntityComponentHistory")",
                contentType: "application/json; charset=utf-8",
                data: { "EntityComponentID": EntityComponentID },
                dataType: "json",
                success: function (response) {
                    HistorybindGrid(response.Data);
                    OpenModal("tab", 910, "Entity Component");
                },
                error: function (data) {
                    alert("something went wrong");
                }
            });
        }

        var histkgrid = "";
        function HistorybindGrid(Data1) {
            if (histkgrid != "") {
                $('#kgrdHistory').kendoGrid('destroy').empty();
            }
            histkgrid = $("#kgrdHistory").kendoGrid({
                dataSource: {
                    pageSize: 10,
                    data: JSON.parse(Data1)
                },
                columns: [
                    { field: "COMPONENT_TYPE", title: "Component Type", width: 130 },
                    { field: "COMPONENT_SUB_TYPE", title: "Component Sub Type", width: 150 },
                    { field: "COMPONENT_NAME", title: "Component Name", width: 150 },
                    { field: "MANDATORY_STATUS", title: "Mandatory", width: 150 },
                    { field: "STATUS", title: "Status", width: 100, template: "<span class= #if(STATUS=='Active'){#'BtnApproved Setlabel'#}else{#'BtnGray Setlabel'# }#   >#:STATUS#</span>" },
                    { field: "CREATED_BY", title: "Action User", width: 120 },
                    { field: "CREATE_ON", title: "Created On", width: 100 },
                    { field: "UPDATE_ON", title: "Updated On", width: 100 },
                    { field: "ACTION", title: "Action", width: 100 },
                ],
                dataBound: function (e) {
                    var grid = e.sender;
                    if (grid.dataSource.total() == 0) {
                        var colCount = grid.columns.length;
                        //$(e.sender.wrapper)
                        //    .find('tbody')
                        //    .append('<tr class="kendo-data-row"><td colspan="' + colCount + '" class="no-data"><span style="margin-left:46%;">No data found.</span></td></tr>');
                    }
                    else {
                        var rows = grid.dataSource.total();
                        var colCount = grid.columns.length;
                        for (var i = rows - 1; i > 0; i--) {
                            for (var k = 0; k < colCount; k++) {

                                if (grid.tbody[0].children[i].cells[k].innerText != grid.tbody[0].children[i - 1].cells[k].innerText) {
                                    grid.tbody[0].children[i - 1].cells[k].bgColor = "red";
                                }
                            }
                        }
                    }
                },
                noRecords: true,
                filterable: true,
                sortable: true,
                pageable: true,
                reorderable: true,
                resizable: true,




            });
        }
             var Kgrid = "";
        function BindModelGrid() {
            var EntityComponentID = 0;
          //  $.get("@Url.RouteUrl("getEntityComponent")", { EntityCompID: 0 }, function (response) {
                if (Kgrid != "") {
                    $('#KModelgrd').kendoGrid('destroy').empty();
                }
                var GridColumns = [

                    //{ field: "COMPONENT_TYPE", title: "Component Type", width: 130 },
                    //{ field: "COMPONENT_SUB_TYPE", title: "Component Sub Type", width: 150 },
                    //{ field: "COMPONENT_NAME", title: "Component Name", width: 150 },

                ];
                Kgrid = $("#KModelgrd").kendoGrid({
                    pageable: { pageSizes: true },
                   // height: auto,
                    filterable: true,
                    noRecords: true,
                    resizable: true,
                    //reorderable: true,
                    dataBound: ShowToolTip,
                    sortable: true,
                    columns: GridColumns,
                });

            //});

        }
    </script>
}